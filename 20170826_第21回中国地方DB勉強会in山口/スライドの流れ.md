# QAリスト
　・ バックアップサイクルは １回/日 固定のまま？  固定のままっぽい
　・ マルチAZの同期レプリケーションは自動？  
　・ リードレプリカの非同期レプリケーションは自動？  
　・ プロビションド IOPS とは？  
　・ m4 クラス： mysql 5.5, 5.6 および , 5.7 がサポート。 <- それ以外無くない？
　・ DBインスタンスが停止の時、リードレプリカが昇格 => マルチAZとどちらが優先？
　・ マルチAZとリードレプリカの違い？
　　 リードレプリカはリージョン間コピーが出来る？
　　 リードレプリカは読み取り専用接続？
　　 DBネイティブで用意されている非同期レプリケーションとディクスレベルの同期レプリケーション
　　

# タイトル
Amazon RDS && Amazon Aurora 入門

# 目次
・ 自己紹介  
・ Amazon RDS の概要と特徴
・ Amazon RDS の料金体系  
・   
・   

# 自己紹介

・ 岡山SIer勤務  
・ JPUG中国支部長  
・ ハリネズミ飼ってる  

次回告知

# 今日話す事

・ Amazon RDS について  
・ Amazon Aurora について  
  
・ ターゲット  
 Amazon RDS って何？ って思ってる人  
 主に僕

# Amazon RDS 概要

・ Amazon RDS の概要
Relational Database Service  
 運用やスケーリングを容易に行う事が出来るフルマネージドなリレーショナルデータベースのサービス。
 
---

Amazon RDS 上で使えるデータベースについて
・ Oracle  
・ SQL Server  
・ MySQL  
・ MariaDB  
・ PostgreSQL  
・ Amazon Aurora  

--- 

# Amazon RDS の 特徴

３つの観点でDBAを楽にしてくれる。  
・ 高い可用性   
・ 高い拡張性   
・ 運用手間からの開放   

--- 

# Amazon RDS の高可用性

・ 数クリックでインスタンスが作成出来る  
　DBエンジンの選択  
　CPU・メモリ・ディスクサイズの選択  

・ オプションで利用出来る高機能  
　マルチAZ (Availbility Zone)   
　リードレプリカ  
　自動バックアップ  

--- 

# DBエンジンについて

--- 

# インスタンスタイプについて

　インスタンスタイプは、現行世代のスタンダードタイプ m4
　メモリ最適化タイプの r3 タイプの中から選べる。

　インスタンスタイプの現在のサポートとしては図のようです。
　Oracle、SQLServerは省きました。
　ライセンスタイプだったりバージョンだったりでサポート状態がかなり異なる為。

　m4: 
  MySQLでは、5.5,5.6,5.7バージョンしかサポートしていない、 -> え？それ以外なくない？
  Aurora: サポート外
　
  r3:

  t2: 条件 VPC内に無ければいけない。

--- 

# マルチAZについて
・ 同期レプリケーション + 自動フェイルオーバー  
    フェイルオーバー時にエンドポイントの向き先がマスターのRDSのインスタンスからスタンバイ中のRDSのインスタンスに自動で切り替わる。  
　
　　アプリケーションの接続先を変更する必要が無い。  

AZレイテンシ影響ある。
BULK INSERT が効果的。

自動的に切り替えるパターンは以下のような場合。
アベイラビリティーゾーンの機能停止
プライマリ DB インスタンスのエラー
DB インスタンスのサーバータイプ変更
DB インスタンスのオペレーティングシステムでソフトウェアのパッチ適用中
DB インスタンスの手動フェイルオーバーが [Reboot with failover] を使用して開始された

--- 

# Amazon RDS の高拡張性
　インスタンスやストレージについて スケールアップやスケールダウンを簡単に行う事が可能
　-> 機能停止を伴うような変更にかんしては、マルチAZのフェイルオーバーで短縮する事が可能。

パラメータグループはデフォルトを使わない
デフォルトは変更できないので変更しないといけない時に
パラメータグループの変更が必要になり再起動が必須になる
デフォルトのままでもコピーしてから使うこと

--- 

# インスタンスクラス
　
　・ 開発・検証用の T2インスタンス  
　・ メモリ重視のR3インスタンス  
　・ CPU重視のM4インスタンス  

# ストレージタイプ
　・  SSD  
　・  IOPS  
プロビジョンドIOPS： 最低限のIOPSを保証する事が出来るストレージ。

　・  Magnetic 

--- 

# スケールアウト
## リードレプリカについて
　・ MySQL、PostgreSQL、MariaDBで使用可能  
　・ 非同期レプリケーション

　最初；スナップショットからインスタンスを生成。
　都度、ソースインスタンスに変更がある度に
　それぞれのDBエンジンに実装されている非同期レプリケーションの仕組みを使用。　

　・ RDSが自動で取ったスナップショットより読み取り専用のインスタンスを作成。
　・ リードレプリカは別のストレージタイプを選択出来る。(マスターと同じストレージタイプを選択する必要がない。)

AWS Database Migration Service を使うと、OracleやSQLServer で使える。

--- 

# Amazon RDS の運用手間からの開放

　・ バックアップの自動化  
　・ サーバーへのセキュリティパッチ適用  
　・ メトリクスの可視化  
　・   

# バックアップ
## 自動バックアップ
　バックアップサイクルは １日 / 回 で設定変更は不可  
　(MySQLはInnodbのみ)  
　任意の時間に手動スナップショットを取ることも出来ます  
　  
　トランザクションログが5分毎に取られていて切り替える事が可能  
　バックアップ保持期間は 0日 ~ 35日間  
　
## リストア
　スナップショットからDBを復元する  
　5分以上前の指定時刻の状態になるようにDBインスタンスを作成する事が可能。

--- 

# 復元について
　エンドポイント  
　・ 復元したDBインスタンスは別エンドポイントとして使用    
　・ 元のDBインスタンスをリネームした後、復元したDBインスタンスのエンドポイントをリネームして使用

--- 

# ソフトウェアメンテナンス
　・ 安全性、堅牢性に関わるソフトウェアパッチを自動で適用　　
 　上記は再起動を伴うケースもあるので、その場合は  
 　曜日、時間帯を予め指定しておく。  

 　・ 数ヶ月に一度の頻度で発生

--- 

# 回避策としてのTips
　・ マルチAZ構成にしてダウンタイムを短縮する。  
　　スタンバイが先にメンテナンスされてフェイルオーバーされる。  

--- 

# 監視
　Mackerel使おうず

---

# 制限事項

・ バージョンが限定される

--- 

・ IPアドレスが固定できない。




# まとめ
Amazon RDS は

--- 

# 第３章 Amazon RDS の料金体系

--- 

# RDSの料金体系 (Aurora以外)
## DBインスタンスタイプ

・ DBエンジン種類による課金 (起動時間が対象)  
・ マルチAZ構成の場合は倍になる。  

## ストレージタイプ

・ ストレージタイプ別に課金 (容量が対象)  
・ マルチAZ構成の場合は倍になる

## データ転送
・ AmazonRDSから別のAWSリージョンへの送信、もしくはインターネットへの通信に対して、課金 (転送量が対象) 　　
・ Amazon RDS <-> EC2 はプライベートネットワーク内での通信に関しては無料

--- 

# 無料利用枠について
Amazon RDS For MySQL, MariaDB, PostgreSQL, Oracle(一部), SQL Server Express
が使用可能。

※ Amazon　Aurora は 無料利用枠対象外

シングルのT2Micro インスタンスを 750時間 / 月  
※ マルチAZ構成は出来ない  

ストレージタイプはSSDのみ　　

--- 

# 朗報

RDS の停止をサポート  
従来： 起動 or 削除 しかできなかった。  

停止をサポートした事により、例えば、開発期間で 業務時間外は止めたい、などという時は止める事が可能に。

--- 
